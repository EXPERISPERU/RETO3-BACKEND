using backend.services.Utils;
using iText.Html2pdf.Resolver.Font;
using iText.Html2pdf;
using iText.Kernel.Geom;
using iText.Kernel.Pdf;
using Microsoft.AspNetCore.Mvc;
using iText.Layout.Element;
using iText.Layout.Properties;
using iText.Layout;
using backend.domain;

namespace backend.services.Controllers.Maestros
{
    [Route("api/[controller]")]
    [ApiController]
    public class AdjuntoController : ControllerBase
    {

        [HttpPost("[action]")]
        public async Task<ActionResult<ApiResponse<string>>> UploadFile([FromBody] imbFile file)
        {
            FtpClient ftpClient = new FtpClient();
            var rsp = ftpClient.UploadFile(file);

            return StatusCode(StatusCodes.Status200OK, rsp);
        }

        [HttpGet("[action]")]
        public async Task<ActionResult> DownloadFile(string sRutaFile)
        {
            try
            {
                FtpClient client = new FtpClient();
                byte[] file = client.DownloadFile(sRutaFile);
                var extension = sRutaFile.Split('/')
                                            .Last()
                                            .Split('.')
                                            .Last()
                                            .ToLower();
                return File(file, client.sContentType(extension), sRutaFile.Split('/').Last());
            }
            catch (Exception ex)
            {
                return StatusCode(500, $"Error interno del servidor: {ex.Message}");
            }
        }

        [HttpGet("[action]")]
        public async Task<ActionResult> GetFormato()
        {
            try
            {
                var sCuerpo = "<!DOCTYPE html>\r\n<html lang=\"es\">\r\n<head>\r\n    <meta charset=\"UTF-8\" />\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"ie=edge\" />\r\n    <title>Comprobante - #sCorrelativo#</title>\r\n        <style>\r\n            body {\r\n                font-family: Arial, sans-serif;\r\n            }\r\n\r\n            .container-principal {\r\n                margin: 0 20px;\r\n            }\r\n\r\n            .datos-boleta {\r\n                border: 3px solid #0aee75;\r\n                border-radius: 10px;\r\n                text-align: center;\r\n                padding: 12px;\r\n                margin-top: -30px;\r\n            }\r\n\r\n            .bordes-plomos {\r\n                width: 100%;\r\n                border: 2px solid #adadad;\r\n                border-radius: 10px;\r\n                overflow: hidden; \r\n            }\r\n            \r\n            .tbl-datos-cliente  {\r\n                padding: 5px;\r\n                font-size: 10px;\r\n            }\r\n\r\n            .tbl-datos-emision  {\r\n                font-size: 10px;\r\n                display: flex;\r\n            }\r\n\r\n            .col-datos-emision {\r\n                width: 20%;\r\n                text-align: center;\r\n            }\r\n\r\n            .col-datos-emision div {\r\n                padding: 3px;\r\n            }\r\n\r\n            .col-borde-derecho {\r\n                border-right: 2px solid #adadad;\r\n            }\r\n\r\n            .tbl-items {\r\n                font-size: 10px;\r\n                width: 100%;\r\n                border-collapse: separate;\r\n                border-spacing: 0;\r\n                overflow: hidden;\r\n                border-radius: 10px;\r\n            }\r\n\r\n            .tbl-items thead th{\r\n                color: white;\r\n                font-size: 9pt;\r\n                text-align: center;\r\n                padding: 5px 0px 5px 0px;\r\n                background: #adadad;\r\n                border-right-style: solid;\r\n                border-right-color: white;\r\n                border-right-width: 0.5px;\r\n            }\r\n\r\n            .tbl-items tbody td{\r\n                border-right-style: solid;\r\n                border-right-color: #aeb1af;\r\n                border-right-width: 0.5px;\r\n                font-size: 8pt;\r\n                height: 20px;\r\n            }\r\n\r\n            .tbl-info-pago {\r\n                width: 100%;\r\n                border-collapse: collapse;\r\n            }\r\n\r\n            .tbl-info-pago tbody td{\r\n                font-family: Arial, sans-serif;\r\n                font-size: 8pt;\r\n                height: 20px;\r\n            }\r\n            \r\n            .td-descripcion-pago{\r\n                font-family: Arial, Helvetica, sans-serif;\r\n                text-align: center;\r\n                background: #aeb1af;\r\n                color: white;\r\n                padding: 5px 0px 5px 0px;\r\n                border-radius: 8px;\r\n                border-color: white;\r\n                border-style: solid;\r\n                border-width: 0px;\r\n            }\r\n\r\n            .td-descripcion-pago-total{\r\n                font-family: Arial, Helvetica, sans-serif;\r\n                text-align: center;\r\n                background: #0058e8;\r\n                color: white;\r\n                padding: 5px 0px 5px 0px;\r\n                border-radius: 8px;\r\n                border-color: white;\r\n                border-style: solid;\r\n                border-width: 0px;\r\n            }\r\n\r\n            .td-valor-pago{\r\n                text-align: right;\r\n                background: white;\r\n                padding: 3px 5px 5px 0px;\r\n                border-radius: 8px;\r\n                border-color: #aeb1af;\r\n                border-style: solid;\r\n                border-width: 2px;\r\n            }\r\n\r\n            .td-valor-pago-total{\r\n                text-align: right;\r\n                font-weight: 800;\r\n                color: #0058e8;;\r\n                background: white;\r\n                padding: 3px 5px 5px 0px;\r\n                border-radius: 8px;\r\n                border-color: #0058e8;\r\n                border-style: solid;\r\n                border-width: 2px;\r\n            }\r\n\r\n            .atencion-info-tit {\r\n                color:#25589e; \r\n                font-size: 12px;\r\n                font-weight: bold;\r\n            }\r\n\r\n            .atencion-info-detalle {\r\n                margin-top: 5px !important;\r\n                font-size: 10px;\r\n            }\r\n\r\n            .info-azul {\r\n                color:#25589e;\r\n            }\r\n\r\n            .div-monto-letras {\r\n                width: 100%;\r\n                font-size: 9px;\r\n                border-radius: 5px;\r\n                border-style: solid;\r\n                border-color: #0aee75;\r\n                border-width: 2px;\r\n            }\r\n\r\n            .info-contacto {\r\n                width: 100%;\r\n                margin-top: 50px;\r\n                background-color: #44b175;\r\n                text-align: center;\r\n                padding: 7px 0px;\r\n                color: white;\r\n                display: flex;\r\n                flex-wrap: wrap;\r\n                align-content: center;\r\n                justify-content: center;\r\n                align-items: center;\r\n            }\r\n\r\n            .div-footer {\r\n                margin-top: 5px;\r\n                padding-bottom: 20px;\r\n                font-family: system-ui, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;\r\n                font-size: 10px;\r\n                color: white;\r\n                text-align: center;\r\n                background-image: url(ComprobanteFooter.png);\r\n                background-size: cover;\r\n                background-position: center;\r\n                background-repeat: no-repeat;\r\n            }\r\n        </style>\r\n    </head>\r\n    <body>\r\n        <div>\r\n            <img width=\"100%\" src=\"ComprobanteHeader.png\">\r\n        </div>\r\n        <div class=\"container-principal\">\r\n            <table width=\"100%\">\r\n                <tbody>\r\n                    <tr>\r\n                        <td width=\"50%\">\r\n                            <div>\r\n                                <p style=\"font-weight: bold; font-size: 12px;\">MULTISERVICIOS E INVERSIONES INMOBITEC S.A.C.</p>\r\n                                <p style=\"font-size: 10px;\">CALLE CHINCHON 910</p>\r\n                                <p style=\"font-size: 10px;\">SAN ISIDRO - LIMA - LIMA</p>\r\n                            </div>\r\n                        </td>\r\n                        <td width=\"50%\">\r\n                            <div style=\"display: flex; flex-direction: row-reverse;\">\r\n                                <div class=\"datos-boleta\">\r\n                                    <div style=\"font-size: 10px;\">RUC: 20601682819</div>\r\n                                    <div style=\"font-weight: bold; font-size: 12px; margin: 12px 0;\">BOLETA DE VENTA ELECTRÓNICA</div>\r\n                                    <div style=\"font-size: 10px;\">Nro. #sComprobante#</div>\r\n                                </div>\r\n                            </div>\r\n                        </td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>\r\n            <br/>\r\n            <table class=\"bordes-plomos tbl-datos-cliente\" cellspacing=\"5\">\r\n                <tr>\r\n                    <td style=\"width: 10%; font-weight: bold;\">Cliente:</td>\r\n                    <td style=\"width: 50%;\">#sNombreCompleto#</td>\r\n                    <td style=\"width: 10%; font-weight: bold;\">Moneda:</td>\r\n                    <td style=\"width: 10%;\">#sMoneda#</td>\r\n                    <td style=\"width: 10%; font-weight: bold;\">IGV:</td>\r\n                    <td style=\"width: 10%;\">#sIGV#</td>\r\n                </tr>\r\n                <tr>\r\n                    <td style=\"width: 10%; font-weight: bold;\">DNI/CE:</td>\r\n                    <td style=\"width: 50%;\">#sDocumento#</td>\r\n                </tr>\r\n                <tr>\r\n                    <td style=\"width: 10%; font-weight: bold;\">Direccion:</td>\r\n                    <td style=\"width: 50%;\">#sDireccion#</td>\r\n                </tr>\r\n                <tr>\r\n                    <td style=\"width: 10%; font-weight: bold;\">Ciudad:</td>\r\n                    <td style=\"width: 50%;\">#sUbigeo#</td>\r\n                </tr>\r\n            </table>\r\n            <br/>\r\n            <div class=\"bordes-plomos tbl-datos-emision\">\r\n                <div class=\"col-datos-emision col-borde-derecho\">\r\n                    <div style=\"font-weight: bold;\">Fecha de Emisión</div>\r\n                    <div >#sFechaEmision#</div>\r\n                </div>\r\n                <div class=\"col-datos-emision col-borde-derecho\">\r\n                    <div style=\"font-weight: bold;\">Condición de Pago</div>\r\n                    <div >#sCondicionPago#</div>\r\n                </div>\r\n                <div class=\"col-datos-emision col-borde-derecho\">\r\n                    <div style=\"font-weight: bold;\">Orden de Pago</div>\r\n                    <div >#sOrdenPago#</div>\r\n                </div>\r\n                <div class=\"col-datos-emision col-borde-derecho\">\r\n                    <div style=\"font-weight: bold;\">Fecha de Vencimiento</div>\r\n                    <div >#sFechaVencimiento#</div>\r\n                </div>\r\n                <div class=\"col-datos-emision\">\r\n                    <div style=\"font-weight: bold;\">Nº Guia de Remisión</div>\r\n                    <div >#sGuiaRemision#</div>\r\n                </div>\r\n            </div>\r\n            <br/>\r\n            <table class=\"bordes-plomos tbl-items\">\r\n                <thead>\r\n                    <th style=\"width: 10%;\">CÓDIGO</th>\r\n                    <th style=\"width: 10%;\">CANT.</th>\r\n                    <th style=\"width: 10%;\">UNID.</th>\r\n                    <th style=\"width: 40%;\">DESCRIPCIÓN</th>\r\n                    <th style=\"width: 10%;\">V.UNT.</th>\r\n                    <th style=\"width: 10%;\">DSCTO.</th>\r\n                    <th style=\"width: 10%; border-right:none !important;\">P.VENTA</th>\r\n                </thead>\r\n                <tbody>\r\n                    #iniItems#\r\n                    <tr>\r\n                        <td style=\"text-align: center;\">#scCodigo#</td>\r\n                        <td style=\"text-align: center;\">#sCant#</td>\r\n                        <td style=\"text-align: center;\">#sUn#</td>\r\n                        <td style=\"text-align: start;\">#Descripcion#</td>\r\n                        <td style=\"text-align: end;\">#sVUnt#</td>\r\n                        <td style=\"text-align: end;\">#sDscto#</td>\r\n                        <td style=\"text-align: end; border-right:none !important;\">#vPVenta#</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td style=\"text-align: center;\">#scCodigo#</td>\r\n                        <td style=\"text-align: center;\">#sCant#</td>\r\n                        <td style=\"text-align: center;\">#sUn#</td>\r\n                        <td style=\"text-align: start;\">#Descripcion#</td>\r\n                        <td style=\"text-align: end;\">#sVUnt#</td>\r\n                        <td style=\"text-align: end;\">#sDscto#</td>\r\n                        <td style=\"text-align: end; border-right:none !important;\">#vPVenta#</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td style=\"text-align: center;\">#scCodigo#</td>\r\n                        <td style=\"text-align: center;\">#sCant#</td>\r\n                        <td style=\"text-align: center;\">#sUn#</td>\r\n                        <td style=\"text-align: start;\">#Descripcion#</td>\r\n                        <td style=\"text-align: end;\">#sVUnt#</td>\r\n                        <td style=\"text-align: end;\">#sDscto#</td>\r\n                        <td style=\"text-align: end; border-right:none !important;\">#vPVenta#</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td style=\"text-align: center;\">#scCodigo#</td>\r\n                        <td style=\"text-align: center;\">#sCant#</td>\r\n                        <td style=\"text-align: center;\">#sUn#</td>\r\n                        <td style=\"text-align: start;\">#Descripcion#</td>\r\n                        <td style=\"text-align: end;\">#sVUnt#</td>\r\n                        <td style=\"text-align: end;\">#sDscto#</td>\r\n                        <td style=\"text-align: end; border-right:none !important;\">#vPVenta#</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td style=\"text-align: center;\">#scCodigo#</td>\r\n                        <td style=\"text-align: center;\">#sCant#</td>\r\n                        <td style=\"text-align: center;\">#sUn#</td>\r\n                        <td style=\"text-align: start;\">#Descripcion#</td>\r\n                        <td style=\"text-align: end;\">#sVUnt#</td>\r\n                        <td style=\"text-align: end;\">#sDscto#</td>\r\n                        <td style=\"text-align: end; border-right:none !important;\">#vPVenta#</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td style=\"text-align: center;\">#scCodigo#</td>\r\n                        <td style=\"text-align: center;\">#sCant#</td>\r\n                        <td style=\"text-align: center;\">#sUn#</td>\r\n                        <td style=\"text-align: start;\">#Descripcion#</td>\r\n                        <td style=\"text-align: end;\">#sVUnt#</td>\r\n                        <td style=\"text-align: end;\">#sDscto#</td>\r\n                        <td style=\"text-align: end; border-right:none !important;\">#vPVenta#</td>\r\n                    </tr>\r\n                    <tr>\r\n                        <td style=\"text-align: center;\">#scCodigo#</td>\r\n                        <td style=\"text-align: center;\">#sCant#</td>\r\n                        <td style=\"text-align: center;\">#sUn#</td>\r\n                        <td style=\"text-align: start;\">#Descripcion#</td>\r\n                        <td style=\"text-align: end;\">#sVUnt#</td>\r\n                        <td style=\"text-align: end;\">#sDscto#</td>\r\n                        <td style=\"text-align: end; border-right:none !important;\">#vPVenta#</td>\r\n                    </tr>\r\n                    #finItems#\r\n                </tbody>\r\n            </table>\r\n            <table width=\"100%\" style=\"margin-top: 5px;\">\r\n                <tbody>\r\n                    <tr>\r\n                        <td width=\"65%\" style=\"vertical-align:top\">\r\n                            <div style=\"width: 100%;\">\r\n                                <div class=\"atencion-info-tit\" style=\"color: #0058e8 !important;\">Observaciones</div>\r\n                                <div class=\"atencion-info-detalle\">Celular: 967283715</div>\r\n                                <div class=\"atencion-info-detalle\">Fijo: 694-8518</div>\r\n                            </div>\r\n                            <br>\r\n                            <div style=\"width: 100%; display: flex; flex-wrap: wrap;\">\r\n                                <div style=\"width:50%\">\r\n                                    <div class=\"atencion-info-tit\">Horario de atención</div>\r\n                                    <div class=\"atencion-info-detalle info-azul\" style=\"margin-left: 10px;\">Lunes a viernes: 9:00 am - 6:00 pm</div>\r\n                                    <div class=\"atencion-info-detalle info-azul\" style=\"margin-left: 10px;\">Sábado: 9:00 am - 1:00 pm</div>\r\n                                </div>\r\n                                <div style=\"width: 50%;\">\r\n                                    <img width=\"101\" height=\"31\" src=\"BbvaLogo.png\"/>\r\n                                </div>\r\n                            </div>\r\n                            <div style=\"width: 100%; display: flex; flex-wrap: wrap; margin-top: 10px;\">\r\n                                <div style=\"width: 50%;\">\r\n                                    <div class=\"atencion-info-tit\">Atención al cliente:</div>\r\n                                    <div class=\"atencion-info-detalle info-azul\" style=\"margin-left: 10px;\">Celular: +51 967 283 715</div>\r\n                                    <div class=\"atencion-info-detalle info-azul\" style=\"margin-left: 10px;\">Fijo : +51 1 6948518 - Opción 3</div>\r\n                                </div>\r\n                                <div style=\"width:50%\">\r\n                                    <div class=\"atencion-info-tit\">Pago de Servicios:</div>\r\n                                    <div class=\"atencion-info-detalle info-azul\">- Inmobitec Gardenias</div>\r\n                                    <div class=\"atencion-info-detalle info-azul\">- Inmobitec Sauces</div>\r\n                                </div>\r\n                            </div>\r\n                        </td>\r\n                        <td width=\"35%\">\r\n                            <table class=\"tbl-info-pago\">\r\n                                <tbody>\r\n                                    <tr>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-descripcion-pago\">OP. GRAVADAS</div></td>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-valor-pago\">#sCant#</div></td>\r\n                                    </tr>\r\n                                    <tr>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-descripcion-pago\">OP. INAFECTA</div></td>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-valor-pago\">#sCant#</div></td>\r\n                                    </tr>\r\n                                    <tr>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-descripcion-pago\">OP. EXONERADA</div></td>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-valor-pago\">#sCant#</div></td>\r\n                                    </tr>\r\n                                    <tr>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-descripcion-pago\">OP. EXPORTACION</div></td>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-valor-pago\">#sCant#</div></td>\r\n                                    </tr>\r\n                                    <tr>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-descripcion-pago\">TOTAL OP. GRATUITAS</div></td>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-valor-pago\">#sCant#</div></td>\r\n                                    </tr>\r\n                                    <tr>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-descripcion-pago\">DSCTOS TOTALES</div></td>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-valor-pago\">#sCant#</div></td>\r\n                                    </tr>\r\n                                    <tr>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-descripcion-pago\">SUB TOTAL</div></td>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-valor-pago\">#sCant#</div></td>\r\n                                    </tr>\r\n                                    <tr>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-descripcion-pago\">ICBPER</div></td>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-valor-pago\">#sCant#</div></td>\r\n                                    </tr>\r\n                                    <tr>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-descripcion-pago\">ISC</div></td>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-valor-pago\">#sCant#</div></td>\r\n                                    </tr>\r\n                                    <tr>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-descripcion-pago\">IGV</div></td>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-valor-pago\">#sCant#</div></td>\r\n                                    </tr>\r\n                                    <tr>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-descripcion-pago-total\">TOTAL</div></td>\r\n                                        <td style=\"width: 50%;\"><div class=\"td-valor-pago-total\">#sCant#</div></td>\r\n                                    </tr>\r\n                                </tbody>\r\n                                \r\n                            </table>\r\n                        </td>\r\n                    </tr>\r\n                </tbody>\r\n            </table>\r\n            <br/>\r\n            <div class=\"div-monto-letras\">\r\n                <div style=\"padding: 5px;\">SON: #sMONTOLETRAS# #sMoneda#</div>\r\n            </div>\r\n        </div>\r\n        <div class=\"info-contacto\">\r\n            <img src=\"facebookIcon.png\"/>\r\n            <img src=\"youtubeIcon.png\" style=\"height: 14px; margin-left: 3px;\"/>\r\n            <div style=\"margin: 0px 20px 0px 5px; font-size: 14px;\">@inmobitecperu</div>\r\n            <img src=\"linkIcon.png\"/>\r\n            <div style=\"margin-left: 5px; font-size: 14px;\">www.inmobitec.pe</div>\r\n        </div>\r\n        <div class=\"div-footer\">\r\n            <br>\r\n            <br>\r\n            <br>\r\n            <div>Operador de Servicios Electrónicos</div>\r\n            <div>según resolución N°034-005-0008776</div>\r\n            <br>\r\n            <br>\r\n            <div>Representación impresa de la boleta de venta electrónica, consulte en www.efact.pe</div>\r\n            <div>Autorizado mediante la Resolución de intendencia N° 0340050004177/SUNAT</div>\r\n        </div>\r\n    </body>\r\n</html>\r\n";

                var html = "<style>.page-break { page-break-after: always; } @page { margin: 0pt; margin-top: 15pt }</style>";

                html += "<div class=\"page-break\">";
                html += sCuerpo
                        .Replace("ComprobanteHeader.png", dataLogoCompania.headerBoleta)
                        .Replace("BbvaLogo.png", dataLogoCompania.bbvaLogo)
                        .Replace("facebookIcon.png", dataLogoCompania.facebookIcon)
                        .Replace("youtubeIcon.png", dataLogoCompania.youtubeIcon)
                        .Replace("linkIcon.png", dataLogoCompania.linkIcon)
                        .Replace("ComprobanteFooter.png", dataLogoCompania.footerBoleta);
                html += "</div>";

                string path = System.IO.Path.Combine(System.IO.Path.GetTempPath(), Guid.NewGuid() + ".pdf");
                ConverterProperties properties = new ConverterProperties();
                properties.SetFontProvider(new DefaultFontProvider(true, true, true));
                PdfDocument pdfDocument = new PdfDocument(new PdfWriter(path));
                pdfDocument.SetDefaultPageSize(new PageSize(PageSize.A4));

                HtmlConverter.ConvertToPdf(html, pdfDocument, properties);

                byte[] file = System.IO.File.ReadAllBytes(path);
                return File(file, "application/pdf");
            }
            catch (Exception)
            {

                throw;
            }
        }

        [HttpGet("[action]")]
        public async Task<ActionResult> GetFormatoPageNumber()
        {
            try
            {
                var sCuerpo = "<!DOCTYPE html>\r\n<html>\r\n    <head>\r\n        <title></title>\r\n    </head>\r\n    <body>\r\n        <h1>#sNombres#</h1>\r\n        <p>This is my first web page.</p>\r\n        <p>It contains a \r\n             <strong>main heading</strong> and <em> paragraph </em>.\r\n        </p>\r\n    <img src=\"https://www.w3schools.com/html/img_chania.jpg\"\r\nwidth=\"460\" height=\"345\" /></body>\r\n</html>";

                var html = "<style>.page-break { page-break-after: always; }</style>";

                html += "<div class=\"page-break\">";
                html += sCuerpo.Replace("#sNombres#", "Mario Robles");
                html += "</div>";

                string path = System.IO.Path.Combine(System.IO.Path.GetTempPath(), Guid.NewGuid() + ".pdf");
                string path2 = System.IO.Path.Combine(System.IO.Path.GetTempPath(), Guid.NewGuid() + ".pdf");
                ConverterProperties properties = new ConverterProperties();
                properties.SetFontProvider(new DefaultFontProvider(true, true, true));
                PdfDocument pdfDocument = new PdfDocument(new PdfWriter(path));
                pdfDocument.SetDefaultPageSize(new PageSize(PageSize.A4));

                HtmlConverter.ConvertToPdf(html, pdfDocument, properties);

                PdfDocument pdfDoc = new PdfDocument(new PdfReader(path), new PdfWriter(path2));
                Document doc = new Document(pdfDoc);

                int numberOfPages = pdfDoc.GetNumberOfPages();
                for (int i = 1; i <= numberOfPages; i++)
                {
                    doc.ShowTextAligned(new Paragraph(i + "/" + numberOfPages), 570, 20, i, TextAlignment.RIGHT, VerticalAlignment.BOTTOM, 0);
                }

                doc.Close();

                byte[] file = System.IO.File.ReadAllBytes(path2);
                return File(file, "application/pdf");
            }
            catch (Exception)
            {

                throw;
            }
        }
    }
}
